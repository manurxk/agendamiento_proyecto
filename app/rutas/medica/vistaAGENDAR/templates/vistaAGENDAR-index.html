{% extends 'base.html' %}

{% block titulo %}
lp3
{% endblock %}

{% block contenido %}


<style>
   /* Estilos generales para el cuerpo de la página */
body {
    font-family: Arial, sans-serif; /* Fuente de la página */
    text-align: center; /* Centra todo el texto en el cuerpo */
    background-color: #f4f4f4; /* Color de fondo gris claro */
    margin: 0; /* Elimina el margen por defecto */
    padding: 0; /* Elimina el padding por defecto */
}

/* Estilos para el título principal */
h1 {
    color: #030505; /* Color oscuro para el texto del título */
}

/* Contenedor para los controles (selectores y botones) */
#controls {
    margin: 20px; /* Espacio alrededor del contenedor */
    display: flex; /* Usamos Flexbox para organizar los controles */
    justify-content: center; /* Centra los controles horizontalmente */
    align-items: center; /* Centra los controles verticalmente */
}


    /* Estilos para el contenedor del calendario */
    #calendar {
        margin: 20px auto; /* Espacio superior e inferior y centrado automático */
        width: 80%; /* El calendario ocupa el 80% del ancho disponible */
        display: flex; /* Flexbox para organizar los días */
        flex-wrap: wrap; /* Permite que los elementos se ajusten a la siguiente línea si es necesario */
        justify-content: center; /* Centra los días horizontalmente */
    }

/* Estilos para el formulario de eventos */
#event-form {
    margin-top: 20px; /* Espacio superior */
}

/* Estilos para los formularios en línea */
form {
    display: inline-block; /* Permite que el formulario esté alineado con otros elementos */
    text-align: left; /* Alinea el texto a la izquierda */
}

/* Estilos para las etiquetas dentro de los formularios */
label {
    display: block; /* Hace que las etiquetas ocupen una línea completa */
    margin: 5px 0; /* Espacio arriba y abajo */
}

/* Estilos para los inputs y botones dentro del formulario */
input, button {
    width: 100%; /* Los inputs y botones ocupan todo el ancho disponible */
    padding: 10px; /* Espacio interno */
    margin: 5px 0; /* Espacio entre los elementos */
}

/* Estilos para las filas dentro del formulario */
.row {
    margin-bottom: 20px; /* Espacio inferior entre filas */
}

/* Clase para los botones de ancho completo */
.btn-block {
    display: block; /* Hace que el botón ocupe todo el ancho disponible */
    width: 100%; /* Asegura que el botón sea de 100% de ancho */
}

/* Estilos para los botones de modificación */
.modify-btn {
    background-color: #ffcc00; /* Fondo amarillo para el botón de modificación */
    border: none; /* Sin borde visible */
    cursor: pointer; /* Cambia el cursor al pasar por encima */
    padding: 5px 10px; /* Espacio interno */
}

/* Contenedor para los controles de la interfaz */
#controls {
    display: flex; /* Usamos Flexbox para organizar los controles */
    align-items: center; /* Alinea los controles verticalmente */
    margin-bottom: 20px; /* Espacio debajo del contenedor */
}

/* Estilos para los elementos select y botón */
select, button {
    padding: 10px; /* Espacio interno para hacerlo más grande */
    font-size: 1rem; /* Tamaño de la fuente */
    margin: 0 10px; /* Espacio entre los elementos */
    border: 1px solid #ccc; /* Bordes suaves */
    border-radius: 5px; /* Bordes redondeados */
}

/* Estilos específicos para los botones */
button {
    background-color: #007BFF; /* Color de fondo azul */
    color: white; /* Color de texto blanco */
    cursor: pointer; /* El cursor se vuelve puntero al pasar por encima */
}

/* Efecto de hover en los botones */
button:hover {
    background-color: #0056b3; /* Cambia el color cuando el mouse pasa sobre el botón */
}

/* Estilos para el contenedor del calendario */
#calendar {
    display: grid; /* Usamos Grid para organizar el calendario */
    grid-template-columns: repeat(7, 1fr); /* 7 columnas para los días de la semana */
    gap: 5px; /* Espacio entre los días */
    width: 90%; /* El calendario ocupa el 90% del ancho disponible */
    max-width: 1000px; /* Limita el ancho máximo */
}

/* Estilos para las cabeceras de los días de la semana */
.day-header {
    text-align: center; /* Centra el texto */
    font-weight: bold; /* Texto en negrita */
    padding: 10px; /* Espacio interno */
    background-color: #f0f0f0; /* Fondo gris claro */
    border: 1px solid #ddd; /* Borde suave */
}

/* Estilos para los días del calendario */
.day {
    position: relative; /* Permite posicionamiento absoluto en los elementos dentro */
    background-color: white; /* Fondo blanco */
    border: 1px solid #ddd; /* Borde suave */
    min-height: 100px; /* Altura mínima para cada día */
    padding: 5px; /* Espacio interno */
    display: flex; /* Flexbox para organizar el contenido dentro de cada día */
    flex-direction: column; /* Organiza los elementos en una columna */
    align-items: flex-start; /* Alinea los elementos al inicio del contenedor */
}

/* Estilos para el encabezado de cada día */
.day header {
    font-weight: bold; /* Hace el texto en negrita */
    margin-bottom: 5px; /* Espacio debajo del encabezado */
}

/* Estilos para los eventos en los días del calendario */
.event {
    margin-top: 5px; /* Espacio superior entre eventos */
    padding: 5px 10px; /* Espacio interno en los eventos */
    font-size: 0.9rem; /* Tamaño de fuente más pequeño */
    border-radius: 5px; /* Bordes redondeados */
    color: white; /* Color de texto blanco */
}

/* Diferentes colores para los eventos */
.event-green {
    background-color: #28a745; /* Verde */
}

.event-yellow {
    background-color: #ffc107; /* Amarillo */
}

.event-blue {
    background-color: #007bff; /* Azul */
}

.event-pink {
    background-color: #e83e8c; /* Rosa */
}

/* Estilos para los emojis dentro de los eventos */
.emoji {
    margin-right: 5px; /* Espacio a la derecha del emoji */
}

</style>

<body>
    
    <div class="welcome-banner">
        <div class="welcome-text">
         
        </div>
       
    </div>
    <div class="card">
        <div class="card-body">
            <table class="table table-striped" id="tbl">
                <thead>
                    <tr>
                        <th>
                            <h1>Agenda Médica</h1>
                            <div class="row my-4">
                                <div class="col-md-4">
                                    <a href="{{ url_for('paciente.pacienteIndex') }}" class="btn btn-info btn-block" id="btnNuevoPaciente">Nuevo Paciente</a>
                                </div>
                                <div class="col-md-4">
                                    <a href="{{ url_for('consulta.consultaIndex') }}" class="btn btn-primary btn-block" id="btnNuevaCita">Nueva Cita</a>
                           
                                </div>
                                <div class="col-md-4">
                                    <a href="/registrar-paciente" class="btn btn-warning btn-block">#</a>
                                </div>
                              </div>
                              <div id="controls">
                                <button id="prev-month">&lt;</button>
                                <select id="month-select"></select>
                                <select id="year-select"></select>
                                <button id="next-month">&gt;</button>
                            </div>
                        </th>
                    </tr>
                </thead>
            </table>
        </div>
    </div><br>




    <div id="calendar"></div>

    <div id="event-form">
        <h2>Registrar Agenda</h2>
        <form id="add-event-form">
            <label for="event-date">Fecha:</label>
            <input type="date" id="event-date" required><br>
            <label for="event-name">Nombre del paciente y descripción:</label>
            <input type="text" id="event-name" required><br>
            <button type="submit">Registrar</button>
        </form>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
          const calendar = document.getElementById('calendar');
          const form = document.getElementById('add-event-form');
          const eventDate = document.getElementById('event-date');
          const eventName = document.getElementById('event-name');
          const monthSelect = document.getElementById('month-select');
          const yearSelect = document.getElementById('year-select');
          const prevMonthButton = document.getElementById('prev-month');
          const nextMonthButton = document.getElementById('next-month');

          let currentDate = new Date();
          let events = JSON.parse(localStorage.getItem('events')) || [];
          let currentEditIndex = null;

          // Inicializar el selector de meses
          const monthNames = ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"];
          monthNames.forEach((month, index) => {
              const option = document.createElement('option');
              option.value = index;
              option.textContent = month;
              monthSelect.appendChild(option);
          });

          // Inicializar el selector de años
          const currentYear = currentDate.getFullYear();
          for (let i = currentYear - 50; i <= currentYear + 50; i++) {
              const option = document.createElement('option');
              option.value = i;
              option.textContent = i;
              if (i === currentYear) {
                  option.selected = true;
              }
              yearSelect.appendChild(option);
          }

          monthSelect.value = currentDate.getMonth();
          yearSelect.value = currentDate.getFullYear();

          monthSelect.addEventListener('change', updateCalendar);
          yearSelect.addEventListener('change', updateCalendar);
          prevMonthButton.addEventListener('click', () => changeMonth(-1));
          nextMonthButton.addEventListener('click', () => changeMonth(1));

          form.addEventListener('submit', function(event) {
              event.preventDefault();
              const date = new Date(eventDate.value);
              const day = date.getDate();
              const month = date.getMonth();
              const year = date.getFullYear();
              const name = eventName.value;

              if (day && name) {
                  if (currentEditIndex !== null) {
                      events[currentEditIndex] = { day, month, year, name };
                      currentEditIndex = null;
                  } else {
                      events.push({ day, month, year, name });
                  }
                  localStorage.setItem('events', JSON.stringify(events));
                  updateCalendar();
                  form.reset();
              } else {
                  alert('Por favor ingrese una fecha y nombre válido.');
              }
          });

          function changeMonth(delta) {
              let newMonth = parseInt(monthSelect.value) + delta;
              let newYear = parseInt(yearSelect.value);

              if (newMonth < 0) {
                  newMonth = 11;
                  newYear--;
              } else if (newMonth > 11) {
                  newMonth = 0;
                  newYear++;
              }

              monthSelect.value = newMonth;
              yearSelect.value = newYear;
              updateCalendar();
          }

          function updateCalendar() {
              const month = parseInt(monthSelect.value);
              const year = parseInt(yearSelect.value);
              calendar.innerHTML = '';

              // Días de la semana
              const weekdays = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
              weekdays.forEach(day => {
                  const dayHeader = document.createElement('div');
                  dayHeader.classList.add('day-header');
                  dayHeader.innerText = day;
                  calendar.appendChild(dayHeader);
              });

              const firstDay = new Date(year, month, 1).getDay(); // Primer día del mes
              const daysInMonth = new Date(year, month + 1, 0).getDate(); // Total de días en el mes

              // Espacios vacíos
              for (let i = 0; i < firstDay; i++) {
                  const emptyDay = document.createElement('div');
                  emptyDay.classList.add('day');
                  calendar.appendChild(emptyDay);
              }

              // Días del mes
              for (let i = 1; i <= daysInMonth; i++) {
                  const day = document.createElement('div');
                  day.classList.add('day');
                  day.innerHTML = `<header>${i}</header>`;
                  calendar.appendChild(day);
              }

              // Mostrar eventos
              events.forEach((event, index) => {
                  if (event.month === month && event.year === year) {
                      const day = calendar.querySelector(`.day:nth-child(${event.day + firstDay + 8})`);
                      if (day) {
                          day.innerHTML += `<div>${event.name} <button class="modify-btn" data-index="${index}">Modificar</button></div>`;
                      }
                  }
              });

              // Botones de modificar
              const modifyButtons = document.querySelectorAll('.modify-btn');
              modifyButtons.forEach(button => {
                  button.addEventListener('click', (e) => {
                      const index = e.target.getAttribute('data-index');
                      const eventToEdit = events[index];

                      eventDate.value = `${eventToEdit.year}-${String(eventToEdit.month + 1).padStart(2, '0')}-${String(eventToEdit.day).padStart(2, '0')}`;
                      eventName.value = eventToEdit.name;
                      currentEditIndex = index;  
                  });
              });
          }

          updateCalendar();
      });
    </script>
</body>
{% endblock %}
